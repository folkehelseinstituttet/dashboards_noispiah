---
output: fhi::noispiah_document
params:
  dev: TRUE
  package_dir: "."
  level: landsdekkende
  location: "Landsdekkende"
  DATE_USE: 2018-05-30
title: "Prevalensundersøkelsen av helsetjenesteassosierte infeksjoner og antibiotikabruk i sykehus (NOIS-PIAH)"
sub_title: "`r ifelse(params$location=='Landsdekkende','Nasjonale resultater',params$location)` --- `r params$DATE_USE`"
header: "Prevalensundersøkelsen for helsetjenesteassosierte infeksjoner og antibiotikabruk \\newline `r params$location` --- `r params$DATE_USE`"
footer: "Folkehelseinstituttet, Oslo, Norge"
authors:
  - "_"
editor_options: 
  chunk_output_type: console
---

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
fhi::DashboardInitialiseOpinionated("noispiah",
                                    PACKAGE_DIR=params$package_dir,
                                    FORCE_DEV_PACKAGE_LOAD = params$dev,
                                    SILENT=TRUE)

suppressMessages(library(data.table))
suppressMessages(library(ggplot2))
  
da <- readxl::read_excel(fhi::DashboardFolder("data_raw","AntibiotikadataSpesialist.xlsx"))
di <- readxl::read_excel(fhi::DashboardFolder("data_raw","InfeksjonsdataSpesialist.xlsx"))

setDT(da)
setDT(di)

level <- params$level
DATE_USE <- params$DATE_USE
CleanDA(da)

if(params$level=="landsdekkende"){
  
} else if(params$level=="helseforetak"){
  da <- da[HelseForetak==params$location]
  di <- di[HelseForetak==params$location]
} else if(params$level=="institusjon"){
  da <- da[Institusjon==params$location]
  di <- di[Institusjon==params$location]
}
```

\newpage 

# Antibiotika til forebygging og behandling

\blindtext

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Figure_AndelAntibiotikaTilForebyggingOgBehandling(di=di,da=da,DATE_USE=DATE_USE)
```

\newpage

# Indikasjoner for forskrivning av antibiotika til behandling 

NEED TO FIX ANTIBIOTICS CATEGORIES

The ordering that was given, does not exist???????

\begin{landscape}

```{r echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
q <- Figure_ForskrivningerAvAntibiotikaTilBehandlingPerIndikasjon(di=di,da=da,DATE_USE=params$DATE_USE)
f <- sprintf("%s.png",tempfile())
ggsave(f, plot = q, width = 297*0.75, height = 210*0.75, units = "mm")
```

\begin{figure}
\begin{center}
\includegraphics{`r f`}
\caption{\label{fig:figs2}Andel forskrivninger av antibiotika til forebygging og behandling i sykehjem, per indikasjon}
\end{center}
\end{figure}

\end{landscape}

\newpage

# Antibiotika til behandling per spesialitet

NEED TO FIX ANTIBIOTICS CATEGORIES

\begin{landscape}

```{r echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
q <- Figure_ForskrivningerAvAntibiotikaTilBehandlingPerSpesialitet(di=di,da=da,DATE_USE=params$DATE_USE)
f <- sprintf("%s.png",tempfile())
ggsave(f, plot = q, width = 297*0.75, height = 210*0.75, units = "mm")
```

\begin{figure}
\begin{center}
\includegraphics{`r f`}
\caption{\label{fig:figs3}Andel forskrivninger av antibiotika til forebygging og behandling i sykehjem, per indikasjon}
\end{center}
\end{figure}

\end{landscape}

\newpage

# Antibiotika til behandling over tid

NEED TO FIX ANTIBIOTICS CATEGORIES

\begin{landscape}

```{r echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
q <- Figure_AntibiotikaTilBehandlingOverTid1(di=di,da=da,DATE_USE=params$DATE_USE)
f <- sprintf("%s.png",tempfile())
ggsave(f, plot = q, width = 297*0.75, height = 210*0.75, units = "mm")
```

\begin{figure}
\begin{center}
\includegraphics{`r f`}
\caption{\label{fig:figs4}Andel forskrivninger av antibiotika til forebygging og behandling i sykehjem, per indikasjon}
\end{center}
\end{figure}

\end{landscape}

\newpage

# Antibiotika til behandling av samfunnservervede nedre luftveisinfeksjoner over tid

NEED TO FIX ANTIBIOTICS CATEGORIES

Could not find "samfunnservervede nedre luftveisinfeksjoner" in "indikasjon"

Decided to just use "nedre luftveisinfeksjoner" instead. Is that ok?

\begin{landscape}

```{r echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
q <- Figure_AntibiotikaTilBehandlingOverTid2(di=di,da=da,DATE_USE=params$DATE_USE)
f <- sprintf("%s.png",tempfile())
ggsave(f, plot = q, width = 297*0.75, height = 210*0.75, units = "mm")
```

\begin{figure}
\begin{center}
\includegraphics{`r f`}
\caption{\label{fig:figs5}Andel forskrivninger av antibiotika til forebygging og behandling i sykehjem, per indikasjon}
\end{center}
\end{figure}

\end{landscape}

\newpage

# Antibiotika til forebygging

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Figure_AntibiotikaTilForebygging(di=di,da=da,DATE_USE=DATE_USE)
```

\newpage

# Antibiotika til behandling

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Figure_AntibiotikaTilBehandling(di=di,da=da,DATE_USE=DATE_USE, indikasjon=NULL)
```

\newpage

# Antibiotika til behandling av nedre luftveisinfeksjoner

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Figure_AntibiotikaTilBehandling(di=di,da=da,DATE_USE=DATE_USE, indikasjon="Nedre luftveisinfeksjon")
```

\newpage

# Antibiotika til behandling OF URINE

TO DO COLOURING!!!!!

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Figure_AntibiotikaTilBehandling(di=di,da=da,DATE_USE=DATE_USE, indikasjon=c(
  "Nedre urinveisinfeksjon",
  "Øvre urinveisinfeksjon"
  ),
  leftVsRightVar="IndikasjonCategorySykehus")
```

\newpage

# Antibiotika til behandling av klinisk sepsis, laboratoriebekreftet blodbaneinfeksjon og nøytropen feber

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Figure_AntibiotikaTilBehandling(di=di,da=da,DATE_USE=DATE_USE, indikasjon="Klinisk sepsis, laboratoriebekreftet blodbaneinfeksjon og nøytropen feber")
```

\newpage

# Deltagelse, forekomst av helsetjenesteassosierte infeksjoner og bruk av antibiotika i sykehus

\blindtext

\begin{landscape}

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results='asis'}
Table_DeltagelseForekomstHAIogABiSykehjem(
  di=di,
  da=da,
  level=params$level,
  DATE_USE=params$DATE_USE,
  type="sykehus")
```

\end{landscape}


\newpage

# Prevalens av helsetjenesteassosierte infeksjoner blant pasienter i sykehus per spesialitet

\blindtext

\newpage

